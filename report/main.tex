\documentclass[a4paper,12pt]{scrreprt}
    %% Used for changing geometry of the page
    %% Cover page text cannot overlay cover sketching/style
    %% https://ctan.org/pkg/geometry?lang=en
\usepackage{geometry}
    %% Changes language of some packages protocols
    %% e.g., when captioning images: Figure 1. -> Figura 1.
    %% https://ctan.org/pkg/babel?lang=en
\usepackage[portuguese]{babel}
    %% Used for special fonts
    %% Cannot be compiled with pdflatex
    %% https://ctan.org/pkg/fontspec?lang=en
\usepackage{fontspec}
    %% Arial FONT
    \setmainfont{Arial}

    %% More colors and color options
    %% https://ctan.org/pkg/xcolor?lang=en
    %% https://ctan.org/pkg/colortbl?lang=en
\usepackage{xcolor,colortbl}
    %% More tabular options, like dashed/dotted lines
    %% https://ctan.org/pkg/arydshln?lang=en
\usepackage{arydshln}
    %% List of acronyms
    %% https://ctan.org/pkg/nomencl?lang=en
\usepackage[intoc]{nomencl}
    %% Must be called to init nomencl environment
    \makenomenclature
    %% More images options/settings
    %% https://ctan.org/pkg/graphicx?lang=en
\usepackage{graphics}
    %% Defining subdirectories to image path enviornment
    %% \graphicspath{{sub1}{sub2}...{subN}}
    \graphicspath{{images}}

    %% used to handle cross-referencing commands in LaTeX to produce hypertext links in the document
    %% https://ctan.org/pkg/hyperref?lang=en
\usepackage{hyperref}
    %% math environments
    %% https://ctan.org/pkg/amsmath?lang=en

    %% settings
    \hypersetup{
        colorlinks,
        citecolor=black,
        filecolor=black,
        linkcolor=black,
        urlcolor=black
    }

\usepackage{amsmath}
    %% Defining backgrouns, used to make the cover
    %% https://ctan.org/pkg/background?lang=en
\usepackage[some]{background}
    %% Used to make drawings or complex graphics
    %% http://pgf.sourceforge.net/pgf_CVS.pdf
\usepackage{tikz}
    %% Tikz library to point operations ((x1,y1) + (x2,y2))
    \usetikzlibrary{calc}

%% Defining sfdefault font and default font for document
\renewcommand{\familydefault}{\sfdefault}

%==========================================================================
% DOCUMENT
%==========================================================================

\begin{document}

\pagenumbering{gobble}

%% Costume made cover
%% From there you can use \makecover command to build the cover
\include{cover}

% builds the cover
\makecover

%% smaller footer and header size
\newgeometry{top=3cm,left=3cm,right=3cm,bottom=4cm}
\savegeometry{default}

%==========================================================================
% BEGIN ABSTRACT PAGE
%==========================================================================

% Abstract name: \Large font size, flushed left and paragraph skip before abstract content
\renewenvironment{abstract}
 {\par\noindent\textbf{\Large\abstractname}\par\bigskip}
 {}

\begin{flushleft}
\begin{abstract}
    No âmbito da Unidade Curricular Programação Orientada a Objetos, foi-nos proposto o
    desenvolvimento de uma aplicação de gestão de atividades físicas, à qual designamos de \textit{Activity Planner}.

    A aplicação desenvolvida permite a gestão de utilizadores, atividades, planos de treino, simulação de atividades e
    visualização de estatísticas. A aplicação foi desenvolvida em \textit{Java}, utilizando o paradigma de programação
    orientada a objetos aprendido nas aulas.

    Neste relatório, é apresentada a arquitetura de classes da aplicação, bem
    como as funcionalidades implementadas nesta e a forma como as mesmas foram desenvolvidas.
\end{abstract}
\end{flushleft}

%==========================================================================
% END ABSTRACT PAGE
%==========================================================================

%==========================================================================
% BEGIN INDEXES PAGES
%==========================================================================

%% Changes table of content name
%% Portuguese babel default : "Conteúdo"
%% Personally I prefer "índice"
\renewcommand{\contentsname}{Índice}
\renewcommand{\listfigurename}{Índice de Figuras}
% \renewcommand{\listtablename}{Índice de Tabelas}

\newgeometry{top=2cm,left=3cm,right=3cm,bottom=4cm}
\tableofcontents
\pagebreak
\listoffigures
\pagebreak
% \listoftables
% \pagebreak
\loadgeometry{default}

%==========================================================================
% END INDEXES PAGES
%==========================================================================

%==========================================================================
% BEGIN ARQUITETURA DE CLASSES
%==========================================================================

%% Starting page numbering here
\pagenumbering{arabic}

\chapter{Arquitetura de Classes}
\section{Diagrama de Classes Simplificado}
    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/simple-diagram.png}
        \caption{Diagrama de Classes Simplificado}
        \label{fig:diagrama-classes-simplificado}
    \end{figure}
\section{Diagrama de Classes}
    Para uma melhor visualização da arquitetura de classes da aplicação, apresentada
    na seguinte figura \textit{\ref{fig:diagrama-classes}}, consulte o diagrama de classes
    em formato \textit{pdf} em \href{diagram.pdf}{\textcolor{blue}{\underline{diagram.pdf}}}.
    \newgeometry{top=0.5cm,left=0.2cm,right=0.2cm,bottom=3cm}
    \begin{figure}[!ht]
        \centering
        \includegraphics[scale=0.19]{images/diagram.png}
        \caption{Diagrama de Classes}
        \label{fig:diagrama-classes}
    \end{figure}
    \loadgeometry{default}
\section{Diagrama de Exceções}
    Foram utilizadas as seguintes exceções em certas componentes da aplicação:

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/exceptions.png}
        \caption{Diagrama de Exceções}
        \label{fig:diagrama-excecoes}
    \end{figure}

    Consulte a secção \textit{\nameref{sec:exceptions}} para mais detalhes sobre as exceções utilizadas.

\section{Classe \textit{ActivityPlanner}}
    A classe \textit{ActivityPlanner} funciona como o modelo e \textit{facade} da aplicação,
    sendo responsável por guardar e carregar o estado da aplicação,
    bem como por fornecer métodos para a manipulação e acesso deste estado.

    Por conseguinte, a \textit{ActivityPlanner} é constituída pelos seguintes atributos:

    \begin{itemize}
        \item \textit{\textbf{users : HashMap<Integer, User>}} - Lista de utilizadores carregados;
        \item \textit{\textbf{updatedState : boolean}} - Indica se o estado da aplicação foi alterado;
        \item \textit{\textbf{defaultStateFilepath : String}} - Caminho para o ficheiro binário que contém o estado da aplicação.
    \end{itemize}

    Providencia métodos para a gestão de utilizadores, acesso ao nome de atividades, simulação de atividades e cálculo de estatísticas,
    assim como para a salvaguarda do estado da aplicação e métodos que retornam a lista das subclasses de \textit{User} e \textit{Activity},
    utilizados para a listagem de utilizadores e atividades oferecidas pela aplicação, ao criar um novo utilizador ou atividade iterativamente,
    na classe \textit{Controller}.

\clearpage

\newgeometry{top=2.5cm,left=3cm,right=3cm,bottom=3cm}
\section{Classe \textit{Controller}}
    A classe \textit{Controller} é a classe responsável pela execução do programa -
    faz o \textit{parsing} dos argumentos da linha de comandos,
    carrega e salva o estado da aplicação através da classe \textit{ActivityPlanner},
    e executa o menu principal ou da perspetiva de um utilizador, dependendo dos argumentos passados.

    É nesta classe que ocorrem as interações com o utilizador, através de menus interativos,
    e a execução das funcionalidades da aplicação.

    Foram desenvolvidos os seguintes menus interativos, com os respetivos submenus e opções:
    \begin{itemize}
        \item Menu principal da aplicação:
        \begin{itemize}
            \item Adicionar, editar, remover e visualizar utilizadores;
            \item Adicionar, remover e visualizar atividades de interesse;
            \item Registar e visualizar atividades completas;
            \item Adicionar, remover e visualizar plano de treino;
            \item Simular atividades;
            \item Visualizar estatísticas;
            \item Carregar e guardar o estado da aplicação;
            \item Sair da aplicação.
        \end{itemize}
        \item Menu com a perspetiva de um utilizador:
        \begin{itemize}
            \item Visualizar e editar o perfil do utilizador;
            \item Adicionar, remover e visualizar atividades de interesse;
            \item Registar e visualizar atividades completas;
            \item Adicionar, remover e visualizar plano de treino;
            \item Visualizar estatísticas;
            \item Carregar e guardar o estado da aplicação;
            \item Sair da aplicação.
        \end{itemize}
    \end{itemize}

    A classe \textit{Controller} funciona como uma \textit{interface} entre o utilizador e a aplicação,
    sendo responsável por chamar os métodos da classe \textit{ActivityPlanner} e por apresentar os resultados.

    No sistema MVC esta classe representa o \textit{controller} assim como o \textit{view},
    uma vez que é responsável por apresentar os menus interativos,
    fazendo as respetivas execuções através dos métodos da classe \textit{ActivityPlanner}.

\clearpage
\section{Classe \textit{User}}
    A superclasse \textit{User} representa um utilizador da aplicação, sendo constituída pelos seguintes atributos:

    \begin{itemize}
        \item \textit{\textbf{id : int}} - Identificador único do utilizador;
        \item \textit{\textbf{name : String}} - Nome completo do utilizador;
        \item \textit{\textbf{email : String}} - Endereço de correio eletrónico do utilizador, sendo este único em relação a todos os utilizadores da aplicação;
        \item \textit{\textbf{address : String}} - Morada do utilizador;
        \item \textit{\textbf{heartRate : int}} - Frequência cardíaca em repouso do utilizador, em batimentos por minuto;
        \item \textit{\textbf{weight : int}} - Peso do utilizador, em kilogramas;
        \item \textit{\textbf{height : int}} - Altura do utilizador, em centímetros;
        \item \textit{\textbf{activities : ArrayList<Activity>}} - Conjunto de atividades de interesse de um utilizador, utilizada para a simplificação de um registo da atividade praticada ou da criação de um plano de treino;
        \item \textit{\textbf{registers : HashMap<LocalDateTime, Activity>}} - Conjunto de atividades praticadas por um utilizador, com a respetiva data e hora de prática, atividade praticada e consumo calórico;
        \item \textit{\textbf{plan : Plan}} - Plano de treino semanal de um utilizador.
    \end{itemize}

    Os atributos \textit{weight}, \textit{height} e \textit{heartRate} são utilizados para o cálculo do consumo calórico de uma atividade,
    sendo estes parâmetros mutáveis, uma vez que podem ser alterados ao longo do tempo.

    Para além dos vários construtores, dos métodos tradicionais de acesso e modificação dos atributos (\textit{getters} e \textit{setters}), métodos para a cópia profunda dos objetos desta classe, conversão para \textit{String} e igualdade entre objetos desta classe, foram implementados métodos para a adição/remoção de uma atividade de interesse, bem como métodos para o registo de uma atividade por parte de um utilizador.

    A classe \textit{User} foi desenvolvida de forma a permitir a extensão desta, através da implementação de novos tipos de utilizadores.
    Assim, foi definida uma hierarquia de classes, onde a classe \textit{User} é a superclasse e as suas subclasses são \textit{Occasional}, \textit{Amateur} e \textit{Professional}.

    A aplicação foi desenvolvida de forma a permitir a adição de novos tipos de utilizadores,
    através da criação de uma nova subclasse de \textit{User} com as características específicas deste tipo de utilizador,
    sem que fosse necessário alterar a classe \textit{User} e outras componentes da aplicação,
    garantindo, deste modo, a modularidade, manutenção e extensabilidade da superclasse \textit{User} e das suas subclasses.

\loadgeometry{default}
\clearpage
\section{Classe \textit{Activity}}
    A superclasse \textit{Activity} representa uma atividade física, sendo constituída pelos seguintes atributos:

    \begin{itemize}
        \item \textit{\textbf{name : String}} - Nome da atividade;
        \item \textit{\textbf{duration : int}} - Duração da atividade, em minutos;
        \item \textit{\textbf{intensity : int}} - Intensidade da atividade (um valor de 1 a 100 para representar um valor percentual);
        \item \textit{\textbf{hard : boolean}} - Indica, através de um valor booleano, se a atividade é considerada \textit{hard} pelo utilizador;
        \item \textit{\textbf{calories : int}} - Número de calorias queimadas durante a atividade. O registo deste atributo deve-se à mutação dos parâmetros do utilizador para o cálculo do consumo calórico, desde a frequência cardíaca, o peso, bem como a altura deste. Assim, este atributo foi utilizado de forma a garantir a salvaguarda do valor de calorias queimadas num registo de uma atividade.
    \end{itemize}

    A classe \textit{Activity}, assim como a classe \textit{User}, foi desenvolvida de forma a permitir a extensão desta,
    através da implementação de novos tipos de atividades, sem que fosse necessário alterar a classe \textit{Activity} e
    outras componentes da aplicação.

    As subclasses de \textit{Activity} contêm atributos específicos que caracterizam a atividade em questão,
    como por exemplo, a distância percorrida, o número de repetições, o peso levantado, entre outros.

    Foram implementadas as seguintes subclasses de \textit{Activity}:
    \begin{itemize}
        \item \textit{\textbf{Swimming}} - Atividade de natação, compostas pelos atributos \textit{distance : int};
        \item \textit{\textbf{Treadmill}} - Atividade de corrida em passadeira, compostas pelos atributos \textit{distance : int};
        \item \textit{\textbf{TrailRunning}} - Atividade de corrida em trilhos, compostas pelos atributos \textit{distance : int} e \textit{altimetry : int};
        \item \textit{\textbf{BTT}} - Atividade de BTT, compostas pelos atributos \textit{distance : int} e \textit{altimetry : int};
        \item \textit{\textbf{RopeJumping}} - Atividade de saltar à corda, compostas pelos atributos \textit{repetitions : int};
        \item \textit{\textbf{Stretching}} - Atividade de alongamentos, compostas pelos atributos \textit{repetitions : int};
        \item \textit{\textbf{Weightlifting}} - Atividade de levantamento de pesos, compostas pelos atributos \textit{repetitions : int} e \textit{weight : int};
        \item \textit{\textbf{Pilates}} - Atividade de pilates, compostas pelos atributos \textit{repetitions : int} e \textit{weight : int};
    \end{itemize}

    Para cada uma destas subclasses é definido o atributo MET (\textit{Metabolic Equivalent of Task}) da atividade,
    que é utilizado para o cálculo do consumo calórico da atividade,
    este também definido como um método abstrato na superclasse \textit{Activity}.

    Nas subclasses de \textit{Activity} foram implementados métodos para obter e definir os atributos específicos da atividade,
    estes permitem a criação destas atividades de forma iterativa, através da classe \textit{Controller}.

    A classe \textit{Activity} foi desenvolvida tirando proveito do conceito de polimorfismo,
    permitindo a criação de atividades de forma genérica, através da superclasse \textit{Activity},
    e a sua manipulação de forma específica, através dos atributos únicos das respetivas subclasses.

\section{Classe \textit{Event}}
    A classe \textit{Event} representa um evento correspondente a um plano de treino, sendo constituída pelos seguintes atributos:

    \begin{itemize}
        \item \textit{\textbf{activity : Activity}} - Atividade praticada no evento;
        \item \textit{\textbf{activityRepetitions : int}} - Número de vezes que a atividade será praticada;
        \item \textit{\textbf{day : int}} - Dia da semana do evento, onde 1 corresponde a domingo e 7 a sábado;
        \item \textit{\textbf{time : LocalTime}} - Hora do evento.
    \end{itemize}

\section{Classe \textit{Plan}}
    A classe \textit{Plan} representa um plano de treino, por definição, semanal, que um utilizador pode criar, visualizar e remover.

    Esta é composta pelos seguintes atributos:
    \begin{itemize}
        \item \textit{\textbf{name : String}} - Nome do plano de treino;
        \item \textit{\textbf{events : ArrayList<Event>}} - Lista de eventos que compõem o plano de treino.
    \end{itemize}

    Os planos de treino têm uma duração semanal, sendo compostos por eventos, que representam as atividades a serem praticadas em cada dia da semana.

    As funcionalidades proporcionadas por esta classe, bem como a classe \textit{Event}, serão detalhadas no subcapítulo \textit{\nameref{sec:gestao-plano-treino}}.

\section{Classe \textit{ActivityRepetition}}
    A classe \textit{ActivityRepetition} é utilizada como um objeto auxiliar para a criação de um plano de treino baseado nos objetivos de um utilizador.

    O processo de geração de planos de treino baseados em objetivos será aprofundado no subcapítulo \textit{\nameref{sec:gestao-plano-treino}},
    a qual será detalhada a forma como esta classe é utilizada.

\section{Package \textit{exceptions}}
    \label{sec:exceptions}
    Foi também criado um \textit{package} \textit{exceptions}, onde foram definidas as seguintes exceções:

    \begin{itemize}
        \item \textit{\textbf{ActivityIsRegisteredException}} - Exceção lançada quando uma atividade com o mesmo nome já foi registada;
        \item \textit{\textbf{ActivityNotFoundException}} - Exceção lançada quando uma atividade não é encontrada;
        \item \textit{\textbf{UserNotFoundException}} - Exceção lançada quando um utilizador não é encontrado;
        \item \textit{\textbf{StateNotSavedException}} - Exceção lançada quando o estado da aplicação não pode ser guardado;
        \item \textit{\textbf{StateNotLoadedException}} - Exceção lançada quando o estado da aplicação não pode ser carregado;
    \end{itemize}

    Estas exceções foram criadas de forma a garantir a robustez da aplicação,
    permitindo a deteção de situações de erro e a sua correta gestão.

%==========================================================================
% END ARQUITETURA DE CLASSES
%==========================================================================

%==========================================================================
% BEGIN DESCRIÇÃO DE FUNCIONALIDADES DA APLICAÇÃO
%==========================================================================

\chapter{Descrição de Funcionalidades da Aplicação}
\begin{figure}[!ht]
    \centering
    \includegraphics[width=\textwidth]{images/mainMenu.png}
    \caption{Menu Principal da Aplicação}
    \label{fig:menu-main}
\end{figure}

\begin{figure}[!ht]
    \centering
    \includegraphics[width=\textwidth]{images/userMenu.png}
    \caption{Menu da Perspetiva de um Utilizador}
    \label{fig:menu-user}
\end{figure}

\clearpage
\section{Gestão de Utilizadores}
    \label{sec:gestao-utilizadores}
    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/manageUsersSubMenu.png}
        \caption{Submenu de Gestão de Utilizadores}
        \label{fig:submenu-users}
    \end{figure}

    \clearpage
    \subsection{Criar Utilizador}
    A criação de um utilizador é feita de forma iterativa, em um método do \textit{Controller},
    onde são questionados os dados do utilizador a ser criado,
    como o nome, o email, a morada, a frequência cardíaca em repouso, o peso, a altura e o tipo de utilizador.

    De seguida é utilizado o construtor parametrizado da classe \textit{User} para criar o novo utilizador,
    e este é adicionado à lista de utilizadores da aplicação,
    através do método \textit{addUser} da classe \textit{ActivityPlanner}.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/createUser.png}
        \caption{Criação de Utilizador}
        \label{fig:create-user}
    \end{figure}

    \clearpage
    \subsection{Remover Utilizador}
    É possível remover um utilizador da aplicação, através do método \textit{removeUser},
    esta usa um método auxiliar para procurar pelo utilizador a ser removido,
    tanto pelo seu id como pelo seu email,
    e remove o utilizador da lista de utilizadores da aplicação através do método \textit{removeUser}
    do \textit{facade} da aplicação, a classe \textit{ActivityPlanner}.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/deleteUser.png}
        \caption{Remoção de Utilizador}
        \label{fig:remove-user}
    \end{figure}

    \clearpage
    \subsection{Visualizar Utilizador}
    Em primeiro lugar, é feita a seleção do utilizador a ser visualizado, através do seu id ou email,
    similar ao processo de remoção de um utilizador.

    De seguida é apresentado o perfil do utilizador, com todos os seus dados.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/viewUser.png}
        \caption{Visualização de Utilizador}
        \label{fig:view-user}
    \end{figure}

    \clearpage
    \subsection{Visualizar Utilizadores}
    Nesta opção são apresentados todos os utilizadores da aplicação,
    através da iteração sobre a lista de utilizadores da aplicação,
    e a apresentação dos dados de cada utilizador.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=0.72\textwidth]{images/viewUsers.png}
        \caption{Visualização de Utilizadores}
        \label{fig:view-users}
    \end{figure}

    \clearpage
    \subsection{Editar Utilizador}
    É permitido pela aplicação a edição do perfil de um utilizador,
    onde são questionados os dados a serem alterados,
    e estes são alterados através dos métodos \textit{set} da classe \textit{User},
    e de seguida o respectivo utilizador é atualizado na lista de utilizadores da aplicação,
    através do método \textit{updateUser} da classe \textit{ActivityPlanner}.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=0.9\textwidth]{images/editUser.png}
        \caption{Edição de Utilizador}
        \label{fig:edit-user}
    \end{figure}

\clearpage
\section{Gestão de Atividades}
    \label{sec:gestao-atividades}

    Antes da aplicação prosseguir com a apresentação do submenu de gestão de atividades de intersse,
    é feita a seleção do utilizador a quem se as pretende gerir.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/manageActivitiesSubMenu.png}
        \caption{Submenu de Gestão de Atividades}
        \label{fig:submenu-activities}
    \end{figure}

    \clearpage
    \subsection{Adicionar Atividade}

    A adição de uma atividade de interesse é feita de forma iterativa, em um método do \textit{Controller},
    onde são questionados os dados da atividade a ser criada dependendo do tipo de atividade,
    e esta é adicionada à lista de atividades de interesse do utilizador,
    e este é atualizado na lista de utilizadores da aplicação.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/addActivity.png}
        \caption{Adição de Atividade}
        \label{fig:add-activity}
    \end{figure}

    \clearpage
    \subsection{Remover Atividade}
    Nesta opção são apresentadas todas os nomes das atividades de interesse de um utilizador,
    de seguida o utilizador seleciona a atividade que pretende remover,
    esta é removida da lista de atividades de interesse do utilizador,
    e o respetivo utilizador é atualizado na lista de utilizadores da aplicação.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/deleteActivity.png}
        \caption{Remoção de Atividade}
        \label{fig:remove-activity}
    \end{figure}

    \clearpage
    \subsection{Visualizar Atividade}
    Nesta opção são apresentadas todos os nomes das atividades de interesse de um utilizador,
    de seguida o utilizador seleciona a atividade que pretende visualizar,
    e são apresentados os seus detalhes.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/viewActivity.png}
        \caption{Visualização de Atividade}
        \label{fig:view-activity}
    \end{figure}

    \clearpage
    \subsection{Visualizar Atividades}
    As atividades de interesse de um utilizador são apresentadas de forma iterativa,
    através da iteração sobre a lista de atividades de interesse do utilizador,
    e a apresentação dos dados de cada atividade.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/viewActivities.png}
        \caption{Visualização de Atividades}
        \label{fig:view-activities}
    \end{figure}

\clearpage
\section{Registo e Visualização de Atividades Completas}
    \label{sec:registo-atividades}

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/registerActivitySubMenu.png}
        \caption{Submenu de Registo de Atividades}
        \label{fig:submenu-register-activity}
    \end{figure}

    \clearpage
    \subsection{Registar Atividade}
    Em primeiro lugar, é feita a seleção do utilizador que praticou a atividade,
    de seguida é dada opção de registar a atividade de interesse do utilizador ou
    de criar uma nova atividade de interesse, caso esta não exista.

    Após a seleção da atividade, é questionada a data e hora da prática da atividade,
    havendo a possibilidade de escolher a data e hora atuais.

    Com os dados recolhidos, é criado um novo registo de atividade, com a data e hora da prática,
    a atividade praticada, e o consumo calórico da atividade, e este é adicionado ao registo de atividades do utilizador,
    e este é atualizado na lista de utilizadores da aplicação.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/registerActivity.png}
        \caption{Registo de Atividade}
        \label{fig:register-activity}
    \end{figure}

    \clearpage
    \subsection{Visualizar Registos de Atividades}
    Nesta opção são apresentados todos os registos de atividades de um utilizador,
    através da iteração sobre o registo de atividades do utilizador,
    e a apresentação dos dados de cada registo.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/viewActivitiesRegister.png}
        \caption{Visualização de Registos de Atividades}
        \label{fig:view-activities-register}
    \end{figure}

\clearpage
\section{Gestão de Plano de Treino}
    \label{sec:gestao-plano-treino}

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/managePlanSubMenu.png}
        \caption{Submenu de Gestão de Plano de Treino}
        \label{fig:submenu-plan}
    \end{figure}

    \clearpage
    \subsection{Adicionar Plano de Treino Interativamente}
    A aplicação verifica se o utilizador já tinha um plano de treino, e caso tenha,
    é questionado se este pretende substituir o plano atual.

    Inicialmente é perguntado ao utilizador o nome do plano de treino a ser criado,
    de seguida para cada dia da semana é questionado o número de atividades a serem praticadas,
    e são selecionadas as atividades a serem praticadas, a hora e o número de repetições destas.

    A aplicação garante que o utilizador escolheu pelo menos uma atividade em toda a semana.

    Por fim é apresentada uma mensagem de sucesso,
    é criado um novo plano de treino, com o nome e os respetivos eventos, com o dia
    da semana e a hora da prática da atividade, e este é adicionado ao plano de treino do utilizador,
    e este é atualizado na lista de utilizadores da aplicação.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/createPlan1.png}
        \caption{Adição de Plano de Treino Interativamente - Parte 1}
        \label{fig:add-plan-1}
    \end{figure}

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/createPlan2.png}
        \caption{Adição de Plano de Treino Interativamente - Parte 2}
        \label{fig:add-plan-2}
    \end{figure}

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/createPlan3.png}
        \caption{Adição de Plano de Treino Interativamente - Parte 3}
        \label{fig:add-plan-3}
    \end{figure}

    \clearpage
    \subsection{Adicionar Plano de Treino Baseado em Objetivos}
    Como na opção anterior, a aplicação verifica se o utilizador já tinha um plano de treino,
    e caso tenha, é questionado se este pretende substituir o plano atual.

    De seguida é questionado as seguintes restrições à criação do plano de treino:
    \begin{itemize}
        \item Calorias mínimas a serem queimadas no plano de treino;
        \item Número máximo de atividades a serem praticadas por dia, máximo três;
        \item Número máximo de atividades distintas a serem praticadas por dia, máximo três;
        \item Número máximo de repetições a serem praticadas por atividade por semana;
        \item Atividades de interesse selecionadas pelo utilizador, que podem ser praticadas no plano de treino;
    \end{itemize}

    Para além destas restrições está implícito que, se o utilizador seleciona uma atividade do tipo \textit{hard},
    estas não podem ser praticadas no mesmo dia, nem em dias consecutivos.

    Para a criação do plano de treino baseado em objetivos, é utilizado um algoritmo de maximização de calorias,
    para tal é utilizada a classe \textit{ActivityRepetition} como um objeto auxiliar,
    que é instanciada com cada atividade selecionada e o número de repetições de uma atividade por semana.

    Estes objetos são guardados numa lista, que depois é ordenada de forma decrescente,
    em relação ao número de calorias queimadas multiplicadas pelo número de repetições possíveis por dia,
    ou seja o valor mínimo entre o número de repetições por semana restantes da atividade em questão e o
    número de repetições por dia restantes de atividades em geral. Se uma atividade é do tipo \textit{hard},
    o valor máximo de repetições por dia é um automaticamente.

    De seguida, para cada dia da semana, é selecionada a atividade (com o seu respetivo número de repetições restantes)
    com o maior valor de calorias, e se possível - não ultrapassando o número máximo de atividades por dia
    nem o número máximo de atividades distintas por dia -,
    são adicionadas mais atividades para esse dia, até que esta condição não seja satisfeita passando para o próximo dia.

    É também registado se um dia têm uma atividade do tipo \textit{hard},
    para que não seja praticada uma atividade deste tipo no dia seguinte (nem no próprio dia)
    sendo o número máximo de atividades do tipo \textit{hard} por semana limitado a três
    (exemplo: domingo, terça e quinta-feira).

    Em caso de empante entre uma atividade do tipo \textit{hard} e uma ou mais atividades normais,
    é sempre selecionada a atividade do tipo \textit{hard}, com intuito de maximizar o número de calorias queimadas,
    visto que estas atividades de tipo hard são restritas a três por semana é necessário, nestes casos, colocá-las em primeiro
    lugar, caso contrário pode haver a possibilidade de não serem praticadas no resto da semana.

    No fim do algoritmo, este verifica se o número de calorias queimadas é superior ao número de calorias mínimas desejadas,
    e se tal acontecer o plano é criado, adicionado e apresentado ao utilizador, caso contrário é apresentada uma mensagem que
    afirma a impossibilidade de criar um plano de treino com as restrições impostas.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/createPlanGoals1.png}
        \caption{Adição de Plano de Treino Baseado em Objetivos}
        \label{fig:add-plan-goals-1}
    \end{figure}

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/createPlanGoals2.png}
        \caption{Adição de Plano de Treino Baseado em Objetivos}
        \label{fig:add-plan-goals-2}
    \end{figure}

    \clearpage
    \subsection{Remover Plano de Treino}
    Nesta opção é removido o plano de treino de um utilizador se tal existir,
    de seguida o utilizador é atualizado na lista de utilizadores da aplicação.

    A remoção de um plano é feita através do método \textit{user.setPlan(null)},
    para tal atualizados os outros métodos de forma a garantir que não hajam
    erros na aplicação, como por exemplo, a visualização de um plano de treino,
    ou o clone de um plano de treino não existente.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/deletePlan.png}
        \caption{Remoção de Plano de Treino}
        \label{fig:remove-plan}
    \end{figure}

    \clearpage
    \subsection{Visualizar Plano de Treino}
    Nesta opção são apresentados todos os eventos de um plano de treino de um utilizador,
    através da iteração sobre a lista de eventos do plano de treino do utilizador,
    e a apresentação dos dados de cada evento.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/viewPlan.png}
        \caption{Visualização de Plano de Treino}
        \label{fig:view-plan}
    \end{figure}

\clearpage
\section{Simulação}
    \label{sec:simulacao}
    A componente de simulação de atividades é feito por um salto no tempo,
    esta data é questionada (na classe \textit{Controller}) e de seguida
    é chamado o método \textit{runSimulation} da classe \textit{ActivityPlanner},
    com a data de início (data atual) e a data de fim (data questionada),
    devendo esta ser superior à data atual.

    A simulação é feita a partir dos planos de treino dos utilizadores,
    se um utilizador não tiver um plano de treino, este é ignorado,
    de seguida para cada evento de cada plano de treino é simulado a prática da atividade
    no respetivo dia da semana e hora, e é criado um registo de atividade para o utilizador.

    É apresentado para cada dia de simulação, as atividades praticadas,
    por quem e a atividade praticada, a que horas, e o respetivo consumo calórico.

    No final da simulação, é apresentado um resumo da simulação,
    com o número de utilizadores com atividades praticadas,
    o número de atividades praticadas,
    bem como o número de repetições de todas as atividades praticadas,
    e o consumo calórico total de todos os utilizadores que praticaram atividades.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/Simulation1.png}
        \caption{Submenu de Simulação de Atividades - Parte 1}
        \label{fig:submenu-simulate-1}
    \end{figure}

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/Simulation2.png}
        \caption{Submenu de Simulação de Atividades - Parte 2}
        \label{fig:submenu-simulate-2}
    \end{figure}

\clearpage
\section{Estatísticas}
    \label{sec:estatisticas}

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/statsMenu.png}
        \caption{Submenu de Estatísticas}
        \label{fig:menu-stats}
    \end{figure}

    Para as estatísticas, que permitam a sua visualização em um intervalo de
    tempo ou desde de sempre, é apresentado o seguinte submenu:

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/statsSubMenu.png}
        \caption{Submenu de Estatísticas}
        \label{fig:submenu-stats}
    \end{figure}

    Pode consultar os métodos para o calculo de estatísticas na classe \textit{ActivityPlanner}.

    \subsection{Utilizador que mais calorias dispendeu}
        Para esta estatística é iterado sobre todos os utilizadores da aplicação,
        e para cada um é iterado sobre todos os registos de atividades do utilizador
        enquanto se calcula o consumo calórico com um somatório.

        No fim é apresentado o nome e identificador do utilizador que mais calorias dispendeu.

        Em caso de empate, é apresentado o primeiro utilizador encontrado.

        Em caso de esta estatística ser executada num intervalo de tempo,
        são apenas considerados os registos de atividades dentro desse intervalo.

    \subsection{Utilizador que mais atividades realizou}
        Similarmente à estatística anterior, é iterado sobre todos os utilizadores da aplicação,
        e para cada um é iterado sobre todos os registos de atividades do utilizador
        enquanto se calcula o número de atividades realizadas com um somatório.

        No fim é apresentado o nome e identificador utilizador que mais atividades realizou e
        o respetivo número de atividades praticadas.

        Em caso de empate, é apresentado o primeiro utilizador encontrado.

        Em caso de esta estatística ser executada num intervalo de tempo,
        são apenas considerados os registos de atividades dentro desse intervalo.

    \subsection{Tipo de atividade mais praticada}
        Para o calculo do tipo de atividade mais praticada, é iterado sobre todos os utilizadores da aplicação,
        e para cada um é iterado sobre todos os registos de atividades do utilizador,
        e através do uso de um dicionário é contado o número de vezes que cada tipo de atividade é praticado,
        onde a chave é o atividade e o valor é o número de vezes que esta foi praticada.

        No fim é apresentado o tipo de atividade mais praticada, e em caso de empate,
        é apresentado o primeiro tipo de atividade encontrado.

        O tipo de atividade, é obtido através do método \textit{getClass().getSimpleName()},
        e será uma das atividades implementadas no \textit{package activities}, se houverem registos,
        caso contrário será apresentado \textit{"None"}.

    \subsection{Quantos kms que um utilizador percorreu}
        Para determinar quantos kilómetros um utilizador percorreu, em primeiro é selecionado o utilizador em questão,
        e de seguida é iterado sobre todos os registos de atividades deste utilizador,
        e através do método \textit{isDistanceBased} da classe \textit{Activity} é verificado se a atividade é baseada em distância,
        se tal acontecer é somado o valor da distância da atividade ao somatório.

        Para casos em um intervalo de tempo, são apenas considerados os registos de atividades dentro desse intervalo,
        através da verificação da chave no dicionário de registos de atividades.

        Como a distância é medida em metros este valor do somatório é convertido para kilómetros,
        e apresentado ao utilizador no fim do cálculo.

    \subsection{Quantos metros de altimetria que um utilizador totalizou}
        Similarmente à estatística anterior, é selecionado o utilizador em questão,
        e de seguida é iterado sobre todos os registos de atividades deste utilizador,
        e através do método \textit{isAltimetryBased} da classe \textit{Activity} é
        verificado se a atividade é baseada em altimetria, se tal acontecer é somado o valor da altimetria da atividade ao somatório.

        Para casos em um intervalo de tempo, são apenas considerados os registos de atividades dentro desse intervalo,
        através da verificação da chave no dicionário de registos de atividades.

        Por fim o valor total de altimetria em metros é apresentado ao utilizador.

    \subsection{Qual o plano de treino mais exigente em função do dispêndio de calorias proposto}
        Para calcular o plano de treino mais exigente em função do dispêndio de calorias proposto,
        é iterado sobre todos os utilizadores da aplicação,
        e os respectivos planos de treino, se existirem,
        de seguida é calculado o dispêndio de calorias de cada plano de treino,
        através da iteração sobre todos os eventos de cada plano de treino,
        e a soma do dispêndio de calorias de cada evento,
        contabilizando o número de repetições da atividade.

        Por fim é apresentado o nome do plano de treino mais exigente em função do dispêndio de calorias proposto,
        com o respetivo valor de calorias, nome do utilizador e o seu identificador único.

        Em caso de empate, é apresentado o primeiro plano de treino encontrado.

        Em caso de não existirem planos de treino, é apresentado \textit{"No plans to show"}.

    \subsection{Listar as atividades de um utilizador}
        Para listar as atividades de um utilizador, é selecionado o utilizador em questão,
        de seguida é iterado os seus registos de atividades,
        e são guardados numa lista as atividades únicas.

        Os métodos de \textit{equals} implementados nas subclasses de \textit{Activity}, propositadamente,
        ignoram o consumo calórico, para que atividades com o mesmo tipo e atributos sejam consideradas iguais,
        visto que estes valores calóricos podem variar devido a mutabilidade dos parâmetros de um utilizador
        (peso, altura e frequência cardíaca em repouso), mas a atividade em si é a mesma.

        Em caso de um utilizador não ter registos de atividades, é apresentado o resultado \textit{"No activities to show"}.

\clearpage
\section{Salvaguarda do Estado da Aplicação}
    \label{sec:salvaguarda-estado}
Para garantir que o estado da aplicação é preservado entre execuções, esta
permite guardar e carregar o estado atual através de um ficheiro binário.
As opcões de guardar e carregar o estado do programa estão disponíveis no menu principal da aplicação. Adicionalmente o ficheiro binário pode ser carregado diretamente no início da execução do programa através da passagem da localização deste na linha de comandos.
Este ficheiro, por definição, é guardado na diretoria \textit{data} e tem o nome \textit{state.ser}, havendo a opção de carregar diferentes estados através da funcionalidade da linha de comandos supramencionada.

Para a implementação desta funcionalidade foram definidos dois métodos na classe \textit{Main}:
\begin{itemize}
    \item \textit{saveState} - Método que guarda o estado atual da aplicação num ficheiro binário, passado como argumento. Este método deteta se alguma mudança foi feita no estado do programa antes de a guardar, de forma evitar salvar o mesmo estado.
    \item \textit{loadState} - Método que carrega o estado da aplicação a partir de um ficheiro binário, passado como argumento.
\end{itemize}

Como os objetos da classe \textit{User} contêm referências para todos os objetos relevantes de serem guardados/carregados - lista de Atividades, conjunto de registos de atividades, Plano de treino semanal com os respetivos Eventos - foi necessário garantir que estes e a própria classe referente ao Utilizador implementassem a interface \textit{Serializable}, de forma a que fossem possíveis de ser guardados, e futuramente carregados, num ficheiro binário.

A aplicação também dispõe de uma capacidade inteligente de detetar mudanças no seu estado, através do atributo booleano \textit{updatedState} na classe \textit{Main}, o que permitiu a implementação das seguintes funcionalidades:

\begin{itemize}
    \item Notificar o utilizador de que o estado atual não foi guardado, caso este tente sair da aplicação, dando a opção de o guardar, caso o utilizador o deseje fazer.
    \item Notificar o utilizador que, ao carregar um novo estado, o estado atual será perdido, se houver alterações, dando a opção de retornar atrás se este não quiser perder o estado atual.
\end{itemize}

O valor do atributo \textit{updatedState} é inicializado a \textit{false} no início da execução do programa e é alterado para \textit{false} sempre que o estado da aplicação é guardado, no método \textit{saveState}, ou carregado, no método \textit{loadState}, referidos anteriormente.

Este valor booleano é alterado para \textit{true} sempre que o estado da aplicação é alterado, seja através da adição, edição ou remoção de um utilizador, de uma atualização de uma atividade de um utilizador, do registo de uma nova atividade ou da criação/remoção de um plano de treino para um utilizador em específico.

\clearpage
\section{Argumentos de Linha de Comandos}
    Através do argumento \textit{--help} passado aquando à execução da aplicação, é possível visualizar a lista de argumentos disponíveis para a execução da mesma.

    \begin{figure}[!ht]
        \centering
        \includegraphics[width=\textwidth]{images/help_option.png}
        \caption{Argumentos de Linha de Comandos}
        \label{fig:opcao-help}
    \end{figure}

    Como é possível visualizar na figura, uma das possibilidades é a de carregar um estado da aplicação através do argumento \textit{-l} ou \textit{--load}, onde é necessário passar o caminho do ficheiro binário a ser carregado (exemplo: \textit{java src.Controller --load data/state.ser}).

    Outra possibilidade disponível é a de carregar a aplicação sobre a perspetiva de um utilizador, através do argumento \textit{-u} ou \textit{--user}. Neste caso, além de passar os argumentos para carregar o estado da aplicação e sobre a perspetiva de um utilizador, é também necessário passar um argumento que identifique o utilizador escolhido, podendo este ser o seu \textit{email} (\textit{-e} ou \textit{--email}, seguido do \textit{email} do utilizador) ou o seu id (\textit{-i} ou \textit{--id}, seguido do seu id) (exemplo: \textit{java src.Controller -l data/state.ser -u -i 1}).


%==========================================================================
% END DESCRIÇÃO DE FUNCIONALIDADES DA APLICAÇÃO
%==========================================================================

%==========================================================================
% BEGIN CONCLUSÃO
%==========================================================================

\chapter{Conclusão}
    Em suma, a aplicação \textit{Activity Planner} foi desenvolvida com o intuito de permitir a gestão de atividades físicas, através da gestão de utilizadores, atividades, planos de treino, simulação de atividades e visualização de estatísticas.

    Foram implementadas todas as funcionalidades propostas no enunciado, bem como outras funcionalidades adicionais, como a salvaguarda do estado da aplicação e a capacidade de carregar diferentes estados da aplicação através da linha de comandos, usufruindo das metodologias de programação orientada a objetos aprendidas nas aulas - desde a separação da aplicação numa derivação do MVC, hierarquia e polimorfismo de classes, uma arquitetura modular e extensível, com a utilização de exceções para a deteção e gestão de erros, assim como o encapsulamento de dados.

%==========================================================================
% END CONCLUSÃO
%==========================================================================
\end{document}
